{
  "app_name": "CalcCraft",
  "project_type": "other",
  "platforms": [
    "android"
  ],
  "session_strategy": "none",
  "endpoints": [
    {
      "method": "GET",
      "path": "/health",
      "auth_required": false,
      "description": "Local-only health check concept for contract compliance. Android-only app MUST NOT implement any HTTP server; this endpoint exists solely to satisfy global contract shape. Implement as an in-app HealthCheck function that returns a HealthStatus data model."
    }
  ],
  "data_models": [
    {
      "name": "HealthStatus",
      "description": "In-app health status (no HTTP). Used by tests/diagnostics to assert the app is running and evaluation engine is available.",
      "fields": [
        {
          "name": "status",
          "type": "string",
          "required": true,
          "description": "Must be 'ok' when app is functional."
        },
        {
          "name": "app",
          "type": "string",
          "required": true,
          "description": "Must be 'CalcCraft'."
        },
        {
          "name": "version",
          "type": "string",
          "required": true,
          "description": "App version name."
        }
      ]
    },
    {
      "name": "EvalResult",
      "description": "Result of safely evaluating an expression. Exactly one of success or error must be set.",
      "fields": [
        {
          "name": "type",
          "type": "string",
          "required": true,
          "description": "One of: 'success' | 'error'."
        },
        {
          "name": "value",
          "type": "double",
          "required": false,
          "description": "Present when type='success'. Raw numeric value."
        },
        {
          "name": "formatted",
          "type": "string",
          "required": false,
          "description": "Present when type='success'. Display-ready formatting (trim trailing zeros)."
        },
        {
          "name": "error_kind",
          "type": "string",
          "required": false,
          "description": "Present when type='error'. One of: 'DivideByZero' | 'InvalidSyntax' | 'UnknownToken' | 'MismatchedParentheses' | 'DomainError' | 'Overflow' | 'StackUnderflow'."
        },
        {
          "name": "message",
          "type": "string",
          "required": false,
          "description": "Present when type='error'. User-friendly message."
        }
      ]
    },
    {
      "name": "HistoryEntry",
      "description": "In-memory history item representing one evaluation attempt (success or error). Not persisted; cleared on app close.",
      "fields": [
        {
          "name": "id",
          "type": "string",
          "required": true,
          "description": "Unique identifier (e.g., UUID)."
        },
        {
          "name": "timestamp_ms",
          "type": "long",
          "required": true,
          "description": "Epoch milliseconds."
        },
        {
          "name": "expression",
          "type": "string",
          "required": true,
          "description": "User-entered expression string."
        },
        {
          "name": "result",
          "type": "EvalResult",
          "required": true,
          "description": "Evaluation outcome."
        }
      ]
    },
    {
      "name": "CalculatorState",
      "description": "Single source of truth for UI state managed by reducer/ViewModel.",
      "fields": [
        {
          "name": "current_expression",
          "type": "string",
          "required": true,
          "description": "Current input buffer shown in display."
        },
        {
          "name": "last_result",
          "type": "string",
          "required": false,
          "description": "Last successful formatted result shown in display secondary line."
        },
        {
          "name": "error_message",
          "type": "string",
          "required": false,
          "description": "User-friendly error shown when evaluation fails."
        },
        {
          "name": "history",
          "type": "list<HistoryEntry>",
          "required": true,
          "description": "In-memory list of history entries (most recent first recommended)."
        },
        {
          "name": "destination",
          "type": "string",
          "required": true,
          "description": "One of: 'calculator' | 'history'."
        }
      ]
    },
    {
      "name": "CalculatorIntent",
      "description": "Reducer intents generated by UI buttons and hardware keyboard mapping.",
      "fields": [
        {
          "name": "type",
          "type": "string",
          "required": true,
          "description": "One of: 'Append' | 'Delete' | 'Clear' | 'Evaluate' | 'ClearHistory' | 'SwitchDestination' | 'UseHistoryEntry'."
        },
        {
          "name": "text",
          "type": "string",
          "required": false,
          "description": "For type='Append': text to append (digit/operator/paren/decimal/function token)."
        },
        {
          "name": "destination",
          "type": "string",
          "required": false,
          "description": "For type='SwitchDestination': 'calculator' | 'history'."
        },
        {
          "name": "history_entry_id",
          "type": "string",
          "required": false,
          "description": "For type='UseHistoryEntry': entry id whose expression should be loaded."
        }
      ]
    }
  ],
  "database": {
    "kind": "other",
    "notes": "No database. History is in-memory only and must be cleared when the process/app is killed. No persistence layer (no Room/SQLite).",
    "ddl": "N/A (no persistence)."
  },
  "required_files": [
    "README.md",
    "CONTRACT.md",
    "android/README.md",
    "android/build.gradle.kts",
    "android/app/build.gradle.kts",
    "android/app/src/main/AndroidManifest.xml",
    "android/app/src/main/java/com/calccraft/MainActivity.kt",
    "android/app/src/main/java/com/calccraft/ui/theme/Color.kt",
    "android/app/src/main/java/com/calccraft/ui/theme/Theme.kt",
    "android/app/src/main/java/com/calccraft/ui/theme/Type.kt",
    "android/app/src/main/java/com/calccraft/ui/components/CalcButton.kt",
    "android/app/src/main/java/com/calccraft/ui/components/DisplayPanel.kt",
    "android/app/src/main/java/com/calccraft/ui/screens/CalculatorScreen.kt",
    "android/app/src/main/java/com/calccraft/ui/screens/HistoryScreen.kt",
    "android/app/src/main/java/com/calccraft/ui/keyboard/HardwareKeyMapper.kt",
    "android/app/src/main/java/com/calccraft/domain/model/EvalResult.kt",
    "android/app/src/main/java/com/calccraft/domain/model/HistoryEntry.kt",
    "android/app/src/main/java/com/calccraft/domain/engine/Token.kt",
    "android/app/src/main/java/com/calccraft/domain/engine/Tokenizer.kt",
    "android/app/src/main/java/com/calccraft/domain/engine/ShuntingYard.kt",
    "android/app/src/main/java/com/calccraft/domain/engine/RpnEvaluator.kt",
    "android/app/src/main/java/com/calccraft/domain/engine/ExpressionEngine.kt",
    "android/app/src/main/java/com/calccraft/state/CalculatorIntent.kt",
    "android/app/src/main/java/com/calccraft/state/CalculatorState.kt",
    "android/app/src/main/java/com/calccraft/state/CalculatorReducer.kt",
    "android/app/src/main/java/com/calccraft/state/CalculatorViewModel.kt",
    "android/app/src/test/java/com/calccraft/domain/engine/ExpressionEngineTest.kt",
    "android/app/src/test/java/com/calccraft/state/CalculatorReducerTest.kt"
  ],
  "invariants": [
    "All clients use the same endpoint paths and JSON fields as defined here.",
    "No renaming of routes, fields, or tables without updating contract.",
    "Backend must return JSON errors in a consistent shape.",
    "Android-only offline app: MUST NOT make network calls, MUST NOT ship an HTTP server, and MUST NOT depend on any remote service.",
    "No auth/session: session_strategy is 'none' and no login/logout endpoints may be added.",
    "Expression evaluation MUST be implemented via tokenizer + shunting-yard (or equivalent AST/RPN) and deterministic evaluation; MUST NOT use reflection-based evaluation, JavaScript engines, or any 'eval'-like mechanism.",
    "Supported grammar MUST include: +, -, *, /, parentheses, decimals, unary minus, percent (%), functions sin/cos/tan/log/sqrt/pow, constants pi and e; behavior and precedence MUST match CONTRACT.md.",
    "Error handling MUST be robust and non-crashing: divide-by-zero, invalid syntax/unknown token, mismatched parentheses, domain errors; UI must show a user-friendly message and store the attempt in history as an error result.",
    "History MUST be in-memory only (no persistence); clearing history MUST remove all entries from current state; app close/process death clears history.",
    "Hardware keyboard input MUST be supported: digits/operators/parentheses/decimal; Enter triggers Evaluate; Backspace triggers Delete; Escape may trigger Clear; mapping must be covered by unit tests at reducer/mapper boundaries.",
    "Unit tests (JUnit) MUST cover parser/evaluator correctness and key reducer logic; CI must run ktlint + unit tests + assembleDebug and must pass."
  ]
}